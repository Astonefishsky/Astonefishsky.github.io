<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.0.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta name="google-site-verification" content="fMdXnLxbfVOdv733_WYhGR9IYq5Ga2aOQmJ53Zx4qn8"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7Cconsolas:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"astonefishsky.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","width":220,"display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script><meta name="description" content="树莓派4b，蓝牙为WH-BLE103a，是一款有人物联网芯片，内置了天线。"><meta property="og:type" content="article"><meta property="og:title" content="树莓派使用BLE蓝牙收发数据"><meta property="og:url" content="https://astonefishsky.github.io/%E8%93%9D%E7%89%99/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8BLE%E8%93%9D%E7%89%99%E6%94%B6%E5%8F%91%E6%95%B0%E6%8D%AE/index.html"><meta property="og:site_name" content="史莱姆小屋"><meta property="og:description" content="树莓派4b，蓝牙为WH-BLE103a，是一款有人物联网芯片，内置了天线。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://astonefishsky.github.io/%E8%93%9D%E7%89%99/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8BLE%E8%93%9D%E7%89%99%E6%94%B6%E5%8F%91%E6%95%B0%E6%8D%AE/BLE.jpg"><meta property="og:image" content="https://astonefishsky.github.io/%E8%93%9D%E7%89%99/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8BLE%E8%93%9D%E7%89%99%E6%94%B6%E5%8F%91%E6%95%B0%E6%8D%AE/image-20230720165351018.png"><meta property="og:image" content="https://astonefishsky.github.io/%E8%93%9D%E7%89%99/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8BLE%E8%93%9D%E7%89%99%E6%94%B6%E5%8F%91%E6%95%B0%E6%8D%AE/image-20230720165545183.png"><meta property="og:image" content="https://astonefishsky.github.io/%E8%93%9D%E7%89%99/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8BLE%E8%93%9D%E7%89%99%E6%94%B6%E5%8F%91%E6%95%B0%E6%8D%AE/image-20230720165653212.png"><meta property="og:image" content="https://astonefishsky.github.io/%E8%93%9D%E7%89%99/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8BLE%E8%93%9D%E7%89%99%E6%94%B6%E5%8F%91%E6%95%B0%E6%8D%AE/image-20230720175359198.png"><meta property="og:image" content="https://astonefishsky.github.io/%E8%93%9D%E7%89%99/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8BLE%E8%93%9D%E7%89%99%E6%94%B6%E5%8F%91%E6%95%B0%E6%8D%AE/image-20230720175649137.png"><meta property="og:image" content="https://astonefishsky.github.io/%E8%93%9D%E7%89%99/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8BLE%E8%93%9D%E7%89%99%E6%94%B6%E5%8F%91%E6%95%B0%E6%8D%AE/image-20230725151620659.png"><meta property="article:published_time" content="2023-07-20T07:18:18.000Z"><meta property="article:modified_time" content="2023-07-27T08:44:12.676Z"><meta property="article:author" content="瓶装史莱姆酱"><meta property="article:tag" content="蓝牙"><meta property="article:tag" content="树莓派"><meta property="article:tag" content="BLE"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://astonefishsky.github.io/%E8%93%9D%E7%89%99/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8BLE%E8%93%9D%E7%89%99%E6%94%B6%E5%8F%91%E6%95%B0%E6%8D%AE/BLE.jpg"><link rel="canonical" href="https://astonefishsky.github.io/%E8%93%9D%E7%89%99/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8BLE%E8%93%9D%E7%89%99%E6%94%B6%E5%8F%91%E6%95%B0%E6%8D%AE/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://astonefishsky.github.io/%E8%93%9D%E7%89%99/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8BLE%E8%93%9D%E7%89%99%E6%94%B6%E5%8F%91%E6%95%B0%E6%8D%AE/","path":"蓝牙/树莓派使用BLE蓝牙收发数据/","title":"树莓派使用BLE蓝牙收发数据"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>树莓派使用BLE蓝牙收发数据 | 史莱姆小屋</title><link rel="dns-prefetch" href="waline-comments-drab.vercel.app"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">史莱姆小屋</p><i class="logo-line"></i></a></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">33</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">7</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">19</span></a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87"><span class="nav-text">1.前期准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%BF%9E%E6%8E%A5%E8%93%9D%E7%89%99"><span class="nav-text">2.连接蓝牙</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%AB%E6%8F%8F%E5%91%A8%E5%9B%B4%E8%93%9D%E7%89%99%E8%AE%BE%E5%A4%87"><span class="nav-text">扫描周围蓝牙设备</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5BLE%E8%AE%BE%E5%A4%87"><span class="nav-text">连接BLE设备</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92"><span class="nav-text">3.数据交互</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%86%E8%A7%A3%E7%89%B9%E5%BE%81%E5%80%BC"><span class="nav-text">了解特征值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%94%B6%E5%8F%91"><span class="nav-text">数据收发</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%8F%AF%E8%83%BD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">4.可能遇到的问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#0-%E6%9F%A5%E7%9C%8B%E8%93%9D%E7%89%99%E6%97%A5%E5%BF%97"><span class="nav-text">0.查看蓝牙日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-Error-connect-error-Function-not-implemented-38"><span class="nav-text">1.Error: connect error: Function not implemented (38)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2"><span class="nav-text">2.</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="瓶装史莱姆酱" src="/images/first.png"><p class="site-author-name" itemprop="name">瓶装史莱姆酱</p><div class="site-description" itemprop="description">一个个人博客网站，记录生活、学习</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">19</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">33</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Astonefishsky" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Astonefishsky" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:Q20220507@126.com" title="E-Mail → mailto:Q20220507@126.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://astonefishsky.github.io/%E8%93%9D%E7%89%99/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8BLE%E8%93%9D%E7%89%99%E6%94%B6%E5%8F%91%E6%95%B0%E6%8D%AE/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/first.png"><meta itemprop="name" content="瓶装史莱姆酱"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="史莱姆小屋"><meta itemprop="description" content="一个个人博客网站，记录生活、学习"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="树莓派使用BLE蓝牙收发数据 | 史莱姆小屋"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 树莓派使用BLE蓝牙收发数据</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-07-20 15:18:18" itemprop="dateCreated datePublished" datetime="2023-07-20T15:18:18+08:00">2023-07-20</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-07-27 16:44:12" itemprop="dateModified" datetime="2023-07-27T16:44:12+08:00">2023-07-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E8%93%9D%E7%89%99/" itemprop="url" rel="index"><span itemprop="name">蓝牙</span></a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Waline：</span><a title="waline" href="/%E8%93%9D%E7%89%99/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8BLE%E8%93%9D%E7%89%99%E6%94%B6%E5%8F%91%E6%95%B0%E6%8D%AE/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/%E8%93%9D%E7%89%99/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8BLE%E8%93%9D%E7%89%99%E6%94%B6%E5%8F%91%E6%95%B0%E6%8D%AE/" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>3.2k</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p> 树莓派4b，蓝牙为WH-BLE103a，是一款有人物联网芯片，内置了天线。</p><span id="more"></span> <img src="BLE.jpg" alt="BLE" style="zoom:80%"><p>这个芯片到手多天了，最初使用手机和windows端的蓝牙调试都很正常连接，唯独树莓派不能连上，折腾多日，今天终于有了成果。</p><p>手上的树莓派4b安装的是ubuntu20.02，跟普通的树莓派版本不太一样，因此网上的教程很多难以复现，遇到各种各样的问题。</p><h3 id="1-前期准备"><a href="#1-前期准备" class="headerlink" title="1.前期准备"></a>1.前期准备</h3><p>首先树莓派需要安装蓝牙服务的有关软件，这块板子bluez版本为5.53，blueman为蓝牙图形化的工具。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install bluetooth pi-bluetooth bluez blueman</span><br></pre></td></tr></table></figure><p>WH-BLE103a蓝牙芯片可以通过串口进行一些设置，如设置名字、配对码、密码、波特率等等，默认名字为WH-BLE103，不需要密码，波特率为57600。指令部分可以参考这个说明文档<a target="_blank" rel="noopener" href="https://datasheet.lcsc.com/lcsc/2002261032_USR-IOT-WH-BLE103_C488061.pdf">WH-BLE103说明书</a></p><p>这里使用TTL转USB转接头直接和电脑连接，注意供电电压为3.3V。连接方式如下</p><table><thead><tr><th>USB-TTL模块</th><th>WH-BLE103蓝牙模块</th></tr></thead><tbody><tr><td>RX</td><td>UART_TX</td></tr><tr><td>TX</td><td>UART_RX</td></tr><tr><td>3V3</td><td>VBAT</td></tr><tr><td>GND</td><td>GND</td></tr></tbody></table><h3 id="2-连接蓝牙"><a href="#2-连接蓝牙" class="headerlink" title="2.连接蓝牙"></a>2.连接蓝牙</h3><p>在树莓派输入hciconfig查看蓝牙模块是否可用，看到hci0服务即可。</p> <img src="image-20230720165351018.png" alt="image-20230720165351018" style="zoom:67%"><h4 id="扫描周围蓝牙设备"><a href="#扫描周围蓝牙设备" class="headerlink" title="扫描周围蓝牙设备"></a>扫描周围蓝牙设备</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo hcitool lescan</span><br></pre></td></tr></table></figure><p>看到需要的蓝牙mac信息后，ctrl+z停止扫描</p><h4 id="连接BLE设备"><a href="#连接BLE设备" class="headerlink" title="连接BLE设备"></a>连接BLE设备</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo gatttool -b 设备MAC地址 --interactive</span><br><span class="line">connect</span><br></pre></td></tr></table></figure><p>连接成功后就可以和BLE设备进行数据交互了。</p> <img src="image-20230720165545183.png" alt="image-20230720165545183" style="zoom:67%"><h3 id="3-数据交互"><a href="#3-数据交互" class="headerlink" title="3.数据交互"></a>3.数据交互</h3><p>树莓派连接BLE设备后,可以通过gatttool或蓝牙编程接口来发送和接收数据。</p><p>使用gatttool,主要是通过交互模式:</p><h4 id="了解特征值"><a href="#了解特征值" class="headerlink" title="了解特征值"></a>了解特征值</h4><p>不过在那之前，我们要了解BLE蓝牙的特征值，以及如何获取特征值。以下是claude的回答</p><blockquote><p>BLE (Bluetooth Low Energy) 蓝牙特征值(Characteristics)是BLE协议中的一个重要概念。<br>BLE设备通过服务(Services)和特征值进行数据通信。<br>特征值可以理解为服务中的一个数据单元。<strong>每个特征值都有一个UUID作为标识</strong>,并包含了以下信息:</p><ul><li>特征值所包含的数据值(Value)</li><li>描述符(Descriptors),对特征值进行说明或配置</li><li>属性(Properties),定义特征值支持的操作(读、写、通知等)</li></ul><p>举个例子,一个BLE心率监测设备可能有一个心率测量服务(Heart Rate Service),其中包含心率计量特征值(Heart Rate Measurement Characteristic)。<br>这个特征值的UUID是00002A37-0000-1000-8000-00805f9b34fb。它的值就是当前的心率数值。<br>通过读写这个特征值,手机App就可以获取实时心率,或者设置监测参数。<br>所以简单来说,BLE特征值就是服务提供的一个数据单元,用于传输和交互数据。正确理解和使用特征值是开发BLE应用的关键。</p></blockquote><p>我们要收发数据，就要知道“收”和“发”的特征值的uuid，怎么获取呢</p><p>在Linux下,可以使用蓝牙命令行工具gatttool,连接BLE设备后使用primary和characteristics命令获取服务和特征值:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">primary</span><br><span class="line">characteristics</span><br></pre></td></tr></table></figure> <img src="image-20230720165653212.png" alt="image-20230720165653212" style="zoom:67%"><p>知道这些特征值有什么用呢？</p><blockquote><p>根据你提供的这个BLE设备的characteristics信息,我可以做以下分析:</p><ul><li>0x0002: 设备名称服务(Device Name Service)的设备名称characteristic。 properties为0x20表示可读,用于读取设备名称。</li><li>0x0006和0x0008: GAP服务(Generic Access Profile Service)中的外围设备首选连接参数characteristic。properties为0x4E表示可读写,用于协商主从设备的连接参数。</li><li>0x000a: 电池服务(Battery Service)的电池电平characteristic。properties为0x02表示可通知,可以订阅通知获取电池电量信息。</li><li>0x000d: 看起来是一个自定义服务的readable characteristic,可读取某种数据。</li><li>0x0010: 同样是一个自定义服务的writable characteristic,可以写入数据控制设备。</li></ul><p>总结一下,根据UUID和properties可以判断出标准服务的一些基础characteristic,以及自定义服务可能的用途。但不确定的自定义服务需要参考开发文档才能确定。获取characteristics和分析它们的功能是开发BLE应用的关键第一步。</p></blockquote><p>也就是说，<strong>根据handle可以确定这些服务的功能</strong>，<strong>handle相当于是uuid（标识）的简化</strong>，我们可以通过这个句柄（handle）来操作特征值，而<strong>char properties就是特征值的属性</strong>，定义特征值支持的操作(读、写、通知等)。</p><p>那么，后面的char value handle又有什么用呢？</p><blockquote><p>在BLE协议中,Characteristic包含两个相关的Handle(句柄)概念:</p><ol><li>Characteristic Declaration Handle<br>这是Characteristic声明处的Handle,用于唯一标识这个Characteristic,通常简称为Characteristic Handle。<br>例如在你给的例子中,0x0002、0x0006等都是Characteristic Declaration的Handle。</li><li>Characteristic Value Handle<br>这是Characteristic的值对应的Handle,用于读写Characteristic的值,简称为Value Handle。<br>例如在你的例子中,0x0003、0x0007等都是Characteristic Value的Handle。<br>两者的区别和关系:</li></ol><ul><li>Declaration Handle代表整个Characteristic,用于操作Characteristic。</li><li>Value Handle代表Characteristic的值,用于直接读写值。</li><li>Declaration Handle会指向Value Handle,客户端可以通过第一个找到后者。</li><li>在操作时,需要先用Declaration Handle来Discover,再用Value Handle来读写。</li></ul><p>所以简单来说:</p><ul><li><strong>Characteristic Handle是Characteristic的标识符。</strong></li><li><strong>Value Handle是实际存储值的位置。</strong></li><li>通过第一个找到第二个,从而对Characteristic进行操作。</li></ul></blockquote><p>也就是说我们实际操作时，是对Value Handle的值进行操作的</p><h4 id="数据收发"><a href="#数据收发" class="headerlink" title="数据收发"></a>数据收发</h4><p>了解了上述内容，我们就知道该怎样收发数据了</p><p>0x000d和0x0010分别是收和发数据的handle，而我们要操作的是0x000e和0x0011</p><p>输入help，可以看到收发数据的指令</p> <img src="image-20230720175359198.png" alt="image-20230720175359198" style="zoom:67%"><p>例如，发送ffee</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">char-write-req 0x0011 ffee</span><br></pre></td></tr></table></figure><p>通过串口就可以看到发送的内容了（16进制）</p> <img src="image-20230720175649137.png" alt="image-20230720175649137" style="zoom:67%"><h3 id="4-可能遇到的问题"><a href="#4-可能遇到的问题" class="headerlink" title="4.可能遇到的问题"></a>4.可能遇到的问题</h3><p>在连接蓝牙和收发数据的过程中，可能会遇到各种问题，这里简单写一些</p><h4 id="0-查看蓝牙日志"><a href="#0-查看蓝牙日志" class="headerlink" title="0.查看蓝牙日志"></a>0.查看蓝牙日志</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo journalctl -u bluetooth -n 10</span><br></pre></td></tr></table></figure><p>journalctl是Linux系统中管理日志的工具,具体作用如下:</p><ul><li>-u 参数表示查看指定服务的日志,这里我们查看蓝牙服务bluetooth的日志。</li><li>sudo表示用root权限运行命令,查看系统日志通常需要root权限。</li><li>bluetooth是蓝牙服务的系统服务名称。</li><li>-n 参数表示查看最近多少条日志，可以不使用</li></ul><p>使用这个命令可以方便地过滤出蓝牙服务产生的日志,包括启动时的诊断信息、运行时的调试信息、错误日志等。</p><h4 id="1-Error-connect-error-Function-not-implemented-38"><a href="#1-Error-connect-error-Function-not-implemented-38" class="headerlink" title="1.Error: connect error: Function not implemented (38)"></a>1.<code>Error: connect error: Function not implemented (38)</code></h4><img src="image-20230725151620659.png" alt="image-20230725151620659" style="zoom:67%"><p>这种情况不会反映到日志中</p><h4 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h4></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E8%93%9D%E7%89%99/" rel="tag"><i class="fa fa-tag"></i> 蓝牙</a><a href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" rel="tag"><i class="fa fa-tag"></i> 树莓派</a><a href="/tags/BLE/" rel="tag"><i class="fa fa-tag"></i> BLE</a></div><div class="post-nav"><div class="post-nav-item"><a href="/%E6%9D%82%E8%B0%88/%E7%BA%A2%E7%B1%B3Note12Turbo%E4%B8%8A%E6%89%8B%E4%BD%93%E9%AA%8C%E4%B8%8E%E7%9C%9F%E6%88%91GTNeo%E5%AF%B9%E6%AF%94/" rel="prev" title="红米Note12Turbo上手体验与真我GTNeo对比"><i class="fa fa-chevron-left"></i> 红米Note12Turbo上手体验与真我GTNeo对比</a></div><div class="post-nav-item"> <a href="/%E9%9A%8F%E7%AC%94/%E6%9D%AD%E5%B7%9E%E6%B8%B8%E8%AE%B0/" rel="next" title="杭州游记">杭州游记<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2021 – <span itemprop="copyrightYear">2023</span> <span>by</span> <span class="author" itemprop="copyrightHolder">瓶装史莱姆酱</span></div><div class="Thanks"> Thanks <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT</a></div></div></footer><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div> <a href="https://github.com/Astonefishsky" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/js/third-party/search/local-search.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"waline-comments-drab.vercel.app","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":false,"pageview":false,"locale":{"placeholder":"欢迎评论"},"avatar":"mm","meta":["nick","mail","link"],"requiredMeta":[],"pageSize":10,"el":"#waline","comment":true,"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","path":"/%E8%93%9D%E7%89%99/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8BLE%E8%93%9D%E7%89%99%E6%94%B6%E5%8F%91%E6%95%B0%E6%8D%AE/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script></body></html>